---
{"dg-publish":true,"permalink":"/가.오라클/AWR/무제/","dgPassFrontmatter":true,"noteIcon":""}
---

#### CreateDate : 2025-11-05

### GOAL
awrload 진행시 기존 수행된 database 에서 flashback 이 된경우 dbid 와 snap id가 awr repository에서 겹치는 현상을 회피하기 위함 
### Tested Env, APPLIES TO:
Oracle Enterprise Linux 8.10
Oracle Database - Enterprise Edition - Version 19.24

### SOLUTION
```
set echo off heading on underline on verify off feedback off linesize 120 termout on
whenever sqlerror exit

prompt ~~~~~~~~~~
prompt  AWR LOAD (with optional NEW_DBID remap)
prompt ~~~~~~~~~~

-- 1) DIRECTORY 안내 및 선택
column dirname format a30 heading 'Directory Name'
column dirpath format a80 heading 'Directory Path'
select directory_name dirname, directory_path dirpath from dba_directories order by 1;

accept p_dir  char   prompt 'Directory name: '
accept p_file char   prompt 'Dump file prefix (without .dmp): '
accept newid  number prompt 'Enter NEW_DBID (-1 to keep source DBID): '

-- 2) 바인드 변수 선언 (선언이 먼저!)
variable dmpdir   varchar2(128)
variable dmpfile  varchar2(4000)
variable change_dbid number

begin
  :dmpdir      := '&&p_dir';
  :dmpfile     := '&&p_file';
  :change_dbid := &&newid;
end;
/

-- 3) 널/존재 체크
whenever sqlerror exit
declare c number;
begin
  if :dmpfile is null then raise_application_error(-20002,'Dump file prefix is NULL'); end if;
  select count(*) into c from dba_directories where directory_name = :dmpdir;
  if c = 0 then raise_application_error(-20003,'Directory not found: '||:dmpdir); end if;
end;
/
whenever sqlerror continue

-- 4) 임포트(확장자는 자동으로 .dmp)
begin
  dbms_workload_repository.awr_imp(
    dmpfile  => :dmpfile,
    dmpdir   => :dmpdir,
    new_dbid => :change_dbid
  );
end;
/

prompt End of AWR Load
```

### Conclusion
충분한 테스트가 되지 않아 검토 필요

### REFERENCES
awrload 파일 분석