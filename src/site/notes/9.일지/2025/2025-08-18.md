---
{"dg-publish":true,"permalink":"/9.일지/2025/2025-08-18/","dgPassFrontmatter":true,"noteIcon":""}
---

## To-Do List
- [ ] HugePages 사용 여부 확인 및 AMM(MEMORY_TARGET) 비호환성 점검
- [ ] 19c/23ai CDB·PDB별 메모리 관리 모드 확인: AMM(메모리 타깃) vs ASMM(SGA_TARGET+PGA_AGGREGATE_TARGET)
- [ ] PDB 레벨에서 MEMORY_TARGET 미지원 확인 및 SGA_TARGET/PGA_AGGREGATE_TARGET 상한 제약 검증
- [ ] AMM↔ASMM 전환 테스트 수행 및 AWR+v$*_advice 결과 수집
- [ ] 테스트 결과 정리: 히트율, 파스 지연, library cache/latch 경합, log file sync 비교

## 기술 파트
### 1) SGA/MEMORY_TARGET 설정 요약(AMM vs ASMM, 19c/23ai, CDB/PDB)
- 개념
  - AMM: MEMORY_TARGET(선택적으로 MEMORY_MAX_TARGET) 하나로 SGA+PGA 합계 자동 조정
  - ASMM: SGA_TARGET(+SGA_MAX_SIZE)과 PGA_AGGREGATE_TARGET을 분리 관리
- 권장
  - HugePages 사용 시 AMM 비권장/비호환(메모리를 HugePages에 고정하면 MEMORY_TARGET 자동 조정 불가) → ASMM 사용 권장
  - 성능·예측가능성 관점에서 ASMM 선호, 필요 시 LOCK_SGA=TRUE로 SGA 고정(환경에 맞게 판단)
- 버전/구성
  - 19c, 23ai 모두 원칙 동일: HugePages와 AMM 비호환 경향, ASMM 일반권장(특화 환경 제외)
  - RAC 환경에서도 노드별 HugePages 설정과 일관된 메모리 정책 필요
- CDB/PDB
  - MEMORY_TARGET은 PDB 레벨에서 설정 불가
  - PDB에서는 SGA_TARGET, PGA_AGGREGATE_TARGET 등만 설정 가능하며 CDB에서 정한 상한 내에서 동작(예: CDB의 PGA_AGGREGATE_LIMIT, CPU_COUNT 대비 비율 제약 등)
- 점검 SQL
  - SHOW PARAMETER hugepages
  - SHOW PARAMETER memory_target
  - SHOW PARAMETER memory_max_target
  - SHOW PARAMETER sga_target
  - SHOW PARAMETER sga_max_size
  - SHOW PARAMETER pga_aggregate_target
  - SHOW PARAMETER pga_aggregate_limit
  - SELECT * FROM v$memory_target_advice;    -- AMM일 때
  - SELECT * FROM v$sga_target_advice;       -- ASMM일 때
- 전환 원칙
  - AMM→ASMM: MEMORY_TARGET=0, MEMORY_MAX_TARGET=0 → SGA_TARGET/PGA_AGGREGATE_TARGET 설정 → 인스턴스 재기동 권장(환경에 따라 필요)
  - ASMM→AMM: HugePages 비활성 또는 재조정 후 MEMORY_TARGET 설정

### 2) SGA 테스트 스크립트(AMM/ASMM 모드별)
- 공통 프롤로그
  - 사전 상태 캡처: `SELECT name, value FROM v$parameter WHERE name IN ('memory_target','memory_max_target','sga_target','sga_max_size','pga_aggregate_target','pga_aggregate_limit');`
  - AWR 스냅샷: `EXEC DBMS_WORKLOAD_REPOSITORY.CREATE_SNAPSHOT;`
- 시나리오 A: ASMM 기준(권장)
  - AMM 비활성화: `ALTER SYSTEM SET memory_target=0 SCOPE=SPFILE;` / `ALTER SYSTEM SET memory_max_target=0 SCOPE=SPFILE;`
  - 목표치 설정(예): `ALTER SYSTEM SET sga_max_size=64G SCOPE=SPFILE;` / `ALTER SYSTEM SET sga_target=48G SCOPE=BOTH;` / `ALTER SYSTEM SET pga_aggregate_target=16G SCOPE=BOTH;`
  - 워크로드 실행 후 스냅샷: `EXEC DBMS_WORKLOAD_REPOSITORY.CREATE_SNAPSHOT;`
  - 조언 뷰: `SELECT * FROM v$sga_target_advice;`
- 시나리오 B: AMM 비교(테스트 전용)
  - 전제: HugePages 비활성/조정
  - 설정 예: `ALTER SYSTEM SET memory_max_target=64G SCOPE=SPFILE;` / `ALTER SYSTEM SET memory_target=56G SCOPE=BOTH;`
  - 워크로드 실행 후 스냅샷: `EXEC DBMS_WORKLOAD_REPOSITORY.CREATE_SNAPSHOT;`
  - 조언 뷰: `SELECT * FROM v$memory_target_advice;`
- 결과 비교 지표
  - buffer cache hit, physical reads, parse time, library cache miss, latch 경합, log file sync, p95/p99, CPU/메모리 스캔·페이지폴트(OS)

### 3) MAD(Median Absolute Deviation) 메모
- 정의: MAD=median(|xi−median(x)|), 정규 보정 σ̂≈1.4826×MAD
- 활용: 시계열 이상치 탐지, 변동성 추정(일부는 추측입니다)

## 비기술 파트
- 요약 산출물 포맷 합의 재확인: 전체 코드 블록, 체크박스 문법 강제, 섹션 순서 고정, 해시태그는 마지막

## 감정 상태
- 누락 항목 즉시 보완 요청으로 품질 관리 집중. 세부 규칙 유지.

## 해시태그
#SGA #MEMORY_TARGET #AMM #ASMM #Oracle